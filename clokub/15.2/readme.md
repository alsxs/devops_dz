# Домашнее задание к занятию 15.2 "Вычислительные мощности. Балансировщики нагрузки".

```text


Используя конфигурации, выполненные в рамках ДЗ на предыдущем занятии добавить к Production like сети Autoscaling group из 2 EC2-инстансов с  автоматической установкой web-сервера в private домен. Создать приватный домен в Route53, чтобы был доступ из VPN.

## Задание 1. Создать bucket S3 и разместить там файл с картинкой.

- Создать бакет в S3 с произвольным именем (например, имя_студента_дата).
- Положить в бакет файл с картинкой.
- Сделать доступным из VPN используя ACL.

---

## Задание 2. Создать запись в Route53 домен с возможностью определения из VPN.

- Сделать запись в Route53 на приватный домен, указав адрес LB.

---

## Задание 3. Загрузить несколько ЕС2-инстансов с веб-страницей, на которой будет картинка из S3.

- Сделать Launch configurations с использованием bootstrap скрипта с созданием веб-странички на которой будет ссылка на картинку в S3.
- Загрузить 3 ЕС2-инстанса и настроить LB с помощью Autoscaling Group.
```
В целом задание выполнено: 
1. В s3 размещена картинка, которая закрыта и доступна только из определенного Vpce при соединении VPN;  
2. Поднимаются инстансы с сайтом с помощью ASG (проверял ручным выключением). Балансировщик при обновлении страницы ожидаемо перекидывает на разные ip;  
3. Сделана запись в Route 53, которая резолвится на балансировщик, который, в свою очередь, в приватные ip (в соответствии с подсказкой в Слаке). Картинка ниже.  
  Также сайт доступен **снаружи** и по имени балансировщика при подключенном VPN.  
  
Нюанс: созданная dns-запись в Route 53 нормально резолвится **только** **внутри** инстансов (при подключении к ним по ssh).  Справиться с организацией возможности входа на сайт по короткому имени снаружи при подключенном VPN не удалось.  
Пытался осуществить указанную возможность с помощью Route 53 Resolver, но видимо там очень много нюансов, не хватает знаний (ну, и накосячил, где-нибудь по-любому). К сожалению, тема особенностей резолва через VPN и приват не раскрывается на лекциях.   
Прошу посмотреть код, подсказать, хотелось бы доуложить картину.
Строки с Route 53 Resolver были закомментированы с целью оставления в состоянии, соответствующем функционально описанному выше.  

Также в интернете и пользователями в самом Амазоне описывается способ достижения желаемого через установку dns bind9 (с настройкой только на перенаправление) в дополнительном инстансе. Но тоже, с ходу не взлетело (если честно, в этот вариант сильно не погружался).  
  
![15.2.png](https://github.com/alsxs/devops_dz/blob/main/clokub/15.2/pics/15.2.png)  
  