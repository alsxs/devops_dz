# Домашнее задание к занятию "15.1. Организация сети"

Настроить Production like сеть в рамках одной зоны с помощью terraform. Модуль VPC умеет автоматически делать все что есть в этом задании. Но мы воспользуемся более низкоуровневыми абстракциями, чтобы понять, как оно устроено внутри.

1. Создать VPC.

- Используя vpc-модуль terraform, создать пустую VPC с подсетью 172.31.0.0/16.
- Выбрать регион и зону.

2. Публичная сеть.

- Создать в vpc subnet с названием public, сетью 172.31.32.0/19 и Internet gateway.
- Добавить RouteTable, направляющий весь исходящий трафик в Internet gateway.
- Создать в этой приватной сети виртуалку с публичным IP и подключиться к ней, убедиться что есть доступ к интернету.
  
```
Выполнение ДЗ разбил на два блока: а) пункты 1-2, б) пункты 3-4.
  
Ниже привожу картинку с пингом и ссылки на скрипты (букв много, решил, что оптимальнее ссылки  
оставить) терраформа по выполнению первых двух пунктов ДЗ:  
```
  
- [main.tf](https://github.com/alsxs/devops_dz/blob/main/clokub/15.1/p1-2/main.tf)  
- [ec2s.tf](https://github.com/alsxs/devops_dz/blob/main/clokub/15.1/p1-2/ec2s.tf)  
- [outputs.tf](https://github.com/alsxs/devops_dz/blob/main/clokub/15.1/p1-2/outputs.tf)  
  
* файл с переменными не загружал, поскольку там ключ ssh
  
![15.1_1-2.png](https://github.com/alsxs/devops_dz/blob/main/clokub/15.1/p1-2/15.1_1-2.png)   

3. Приватная сеть.

- Создать в vpc subnet с названием private, сетью 172.31.96.0/19.
- Добавить NAT gateway в public subnet.
- Добавить Route, направляющий весь исходящий трафик private сети в NAT.

4. VPN.

- Настроить VPN, соединить его с сетью private.
- Создать себе учетную запись и подключиться через нее.
- Создать виртуалку в приватной сети.
- Подключиться к ней по SSH по приватному IP и убедиться, что с виртуалки есть выход в интернет.
  
```
    На сколько я понял для работы с впн нужно, чтобы и в приватной виртуалке  
    был установлен и настроен впн. Так?  
    Предполагая, что ответ ДА (ошибок было много, поэтому сделал так, чтобы хотя бы этот момент   
    исключить), но не зная как устанавливать и настраивать (плюс, как всегда, могут быть нюансы),  
    в качестве образа для приватного инстанса взял готовый с OpenVPN Access.  В целом, все заработало  
    (немного огорчило, что сам образ, вроде, как бесплатный, но его использование запустило платный  
    счетчик за vpc и nat gateway @).
Ниже привожу ссылки на скрипты терраформа по выполнению вторых двух пунктов ДЗ и картинки:  
```
    
- [main.tf](https://github.com/alsxs/devops_dz/blob/main/clokub/15.1/p3-4/main.tf)  
- [ec2s.tf](https://github.com/alsxs/devops_dz/blob/main/clokub/15.1/p3-4/ec2s.tf)  
- [outputs.tf](https://github.com/alsxs/devops_dz/blob/main/clokub/15.1/p3-4/outputs.tf) 
- [vpn.tf](https://github.com/alsxs/devops_dz/blob/main/clokub/15.1/p3-4/vpn.tf)  
  
* файл с переменными не загружал, поскольку там ключи ssh и сертификаты vpn
  
  
```
Вывод подключения к впн:  
```
![15.1_3-4_vpn_connection_out.png](https://github.com/alsxs/devops_dz/blob/main/clokub/15.1/p3-4/15.1_3-4_vpn_connection_out.png)   
  
  
```
Пинг сайта яндекса из приватного инстанса:  
```
![15.1_3-4_ping_ya_from_private.png](https://github.com/alsxs/devops_dz/blob/main/clokub/15.1/p3-4/15.1_3-4_ping_ya_from_private.png)   
  
  
```
Веб-морда сервиса:  
```
![15.1_3-4_web.png](https://github.com/alsxs/devops_dz/blob/main/clokub/15.1/p3-4/15.1_3-4_web.png)   
  